<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Functionality Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .search-container {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .search-input {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            border: 2px solid #ddd;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        .search-results {
            border: 1px solid #eee;
            border-radius: 4px;
            min-height: 100px;
            padding: 10px;
            background: #f9f9f9;
        }
        .result-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            background: white;
            margin-bottom: 5px;
            border-radius: 4px;
        }
        .loading {
            color: #666;
            font-style: italic;
            text-align: center;
        }
        .error {
            color: #d32f2f;
            text-align: center;
        }
        .success {
            color: #2e7d32;
        }
        .test-buttons {
            margin: 20px 0;
        }
        .test-button {
            padding: 10px 20px;
            margin: 5px;
            background: #1976d2;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .test-button:hover {
            background: #1565c0;
        }
    </style>
</head>
<body>
    <h1>üîç Item Service Search Test</h1>
    <p>Test the new search functionality for finding products by text.</p>

    <div class="search-container">
        <h3>Search Products</h3>
        <input type="text" class="search-input" id="searchInput" placeholder="Search by product name, brand, or GTIN...">
        <div class="search-results" id="searchResults">
            <div style="text-align: center; color: #999;">Enter a search term to begin</div>
        </div>
    </div>

    <div class="test-buttons">
        <h3>Quick Tests</h3>
        <button class="test-button" onclick="testSearch('7323342206972')">Test GTIN: 7323342206972</button>
        <button class="test-button" onclick="testSearch('coca cola')">Test Text: coca cola</button>
        <button class="test-button" onclick="testSearch('nike')">Test Brand: nike</button>
        <button class="test-button" onclick="testQuickSearch('test')">Test Quick Search</button>
        <button class="test-button" onclick="testAdvancedSearch('energy drink')">Test Advanced Search</button>
    </div>

    <div class="search-container">
        <h3>Search Logs</h3>
        <div id="searchLogs" style="background: #f5f5f5; padding: 10px; border-radius: 4px; font-family: monospace; font-size: 12px; height: 200px; overflow-y: auto;">
            Logs will appear here...
        </div>
    </div>

    <script>
        // Mock the search functionality for testing
        let searchTimeout;

        function log(message) {
            const logsDiv = document.getElementById('searchLogs');
            const timestamp = new Date().toLocaleTimeString();
            logsDiv.innerHTML += `[${timestamp}] ${message}\n`;
            logsDiv.scrollTop = logsDiv.scrollHeight;
        }

        function updateSearchResults(content) {
            document.getElementById('searchResults').innerHTML = content;
        }

        async function mockItemServiceSearch(query, options = {}) {
            log(`üîç Starting search for: "${query}"`);
            
            // Simulate API delay
            await new Promise(resolve => setTimeout(resolve, 300 + Math.random() * 500));
            
            // Mock some search results based on query
            const mockResults = [];
            
            if (query.includes('7323342206972')) {
                mockResults.push({
                    identifier: { gtin: '7323342206972' },
                    itemText: 'Coca-Cola Original 500ml',
                    brandName: 'Coca-Cola',
                    currentPrice: 2.49,
                    gtin: '7323342206972'
                });
            } else if (query.toLowerCase().includes('coca')) {
                mockResults.push(
                    {
                        identifier: { gtin: '7323342206972' },
                        itemText: 'Coca-Cola Original 500ml',
                        brandName: 'Coca-Cola',
                        currentPrice: 2.49,
                        gtin: '7323342206972'
                    },
                    {
                        identifier: { gtin: '7323342206989' },
                        itemText: 'Coca-Cola Zero 500ml',
                        brandName: 'Coca-Cola',
                        currentPrice: 2.49,
                        gtin: '7323342206989'
                    }
                );
            } else if (query.toLowerCase().includes('nike')) {
                mockResults.push(
                    {
                        identifier: { gtin: '1234567890123' },
                        itemText: 'Nike Air Max 90',
                        brandName: 'Nike',
                        currentPrice: 129.99,
                        gtin: '1234567890123'
                    },
                    {
                        identifier: { gtin: '1234567890124' },
                        itemText: 'Nike Air Force 1',
                        brandName: 'Nike',
                        currentPrice: 99.99,
                        gtin: '1234567890124'
                    }
                );
            } else if (query.toLowerCase().includes('energy')) {
                mockResults.push(
                    {
                        identifier: { gtin: '9876543210123' },
                        itemText: 'Red Bull Energy Drink 250ml',
                        brandName: 'Red Bull',
                        currentPrice: 3.99,
                        gtin: '9876543210123'
                    }
                );
            }
            
            log(`‚úÖ Found ${mockResults.length} results`);
            return {
                success: true,
                items: mockResults,
                totalCount: mockResults.length
            };
        }

        async function performSearch(query) {
            if (!query || query.trim().length < 2) {
                updateSearchResults('<div style="text-align: center; color: #999;">Enter at least 2 characters to search</div>');
                return;
            }

            updateSearchResults('<div class="loading">üîç Searching...</div>');
            log(`Starting search for: "${query}"`);

            try {
                const result = await mockItemServiceSearch(query);
                
                if (result.success && result.items && result.items.length > 0) {
                    let html = `<div class="success">Found ${result.items.length} products:</div>`;
                    
                    result.items.forEach(item => {
                        html += `
                            <div class="result-item">
                                <strong>${item.itemText}</strong><br>
                                <small>Brand: ${item.brandName} | GTIN: ${item.gtin}</small><br>
                                ${item.currentPrice ? `<span style="color: #1976d2; font-weight: bold;">$${item.currentPrice.toFixed(2)}</span>` : ''}
                            </div>
                        `;
                    });
                    
                    updateSearchResults(html);
                    log(`‚úÖ Displayed ${result.items.length} results`);
                } else {
                    updateSearchResults('<div class="error">No products found</div>');
                    log(`‚ùå No results found for: "${query}"`);
                }
            } catch (error) {
                updateSearchResults('<div class="error">Search failed: ' + error.message + '</div>');
                log(`üí• Search error: ${error.message}`);
            }
        }

        function testSearch(query) {
            document.getElementById('searchInput').value = query;
            performSearch(query);
        }

        function testQuickSearch(query) {
            log(`‚ö° Testing quick search for: "${query}"`);
            testSearch(query);
        }

        function testAdvancedSearch(query) {
            log(`üî¨ Testing advanced search for: "${query}"`);
            testSearch(query);
        }

        // Set up search input handler
        document.getElementById('searchInput').addEventListener('input', function(e) {
            const query = e.target.value;
            
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                performSearch(query);
            }, 300); // Debounce search
        });

        // Initialize
        log('üöÄ Search test interface ready');
        log('üí° The actual implementation will use real Item Service API calls');
        log('üìù This is a demo showing the expected search behavior');
    </script>
</body>
</html>
